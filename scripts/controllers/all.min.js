sukuApp.controller("ClassroomPropertiesCtrl",["ClassroomModel","StudentsClassroomModelFactory",function(c,b){var a=this;a.setClassroom=function(f){a.dialog=angular.element("#classroom-properties-modal");a.working=false;a.error=null;a.loading=true;a.classroom=f;a.files=f.files;a.olds=f.olds;a.comments=f.comments;f.getOldComments().then(function(){a.loading=false},function(){a.error="error while getting messages";console.log("bad")});console.log("ps");var d=b.elts[a.classroom.sid];if(!d){return}var g=d.count();var e=0,h=0;d.each(function(i){if(i.sexe=="1"){++e}if(i.sexe=="2"){++h}});if(g){male_per=Number(100*e/g).toFixed(1);female_per=Number(100*h/g).toFixed(1)}else{male_per=female_per=0}a.properties={responsible:a.classroom.responsible,title:a.classroom.name+", "+a.classroom.school,std:g,male:e,male_per:male_per,female:h,female_per:female_per}};a.openDialog=function(){a.dialog.modal()};a.publish=function(e){a.working=true;var d={msg:e};a.classroom.publish(d).then(function(){a.working=false;a.error=null},function(f){console.log(f);a.error=f.msg;a.working=false})};a.addFile=function(d){console.log(a.classroom);a.classroom.addFile(d).then(function(e){a.working=false;console.log("add file");a.error=null;console.log(d);a.publish("attached a file ("+d.name+")")},function(e){a.working=false;console.log("editTof2");console.log(e);a.error=e.msg})}}]);sukuApp.controller("ImportStudentsCtrl",[function(){var a=this;a.dialog=angular.element("#import-students-modal");a.paths=[];a.setClassroomCtrl=function(b){a.working=false;a.loading=false;a.error=null;a.classroomCtrl=b};a.init=function(){a.paths=[];a.working=false;a.loading=false;a.error=null;a.dialog.modal()};a.import_students=function(){a.working=true;a.classroomCtrl.import_students_from_file(a.paths).then(function(){a.working=false;a.dialog.modal("hide")},function(b){a.error=b.msg;a.working=false})}}]);sukuApp.controller("InviteUserCtrl",["AuthLoaderService",function(a){var b=this;b.init=function(c){b.dialog=angular.element("#invite-user-modal");b.working=false;b.error=null;b.classrooms=c};b.openDialog=function(){b.working=false;b.error=null;for(var c=0;c<b.classrooms.length;++c){b.classrooms[c].selected=false}b.dialog.modal()};b.invite=function(d){console.log("invite");b.working=true;var f=[];for(var e=0;e<b.classrooms.length;++e){if(b.classrooms[e].selected){f.push(b.classrooms[e])}}b.error="";var c=f.length;a.invite(d).then(function(){if(!f.length){b.working=false;return}for(var g=0;g<f.length;++g){f[g].share(d).then(function(){if(--c!=0){return}b.working=false;b.dialog.modal("hide")},function(h){console.log(h);if(--c!=0){return}b.error+=h.msg;b.working=false})}},function(g){console.log(g);b.error+=g.msg;b.working=false})}}]);sukuApp.controller("MainCtrl",["AuthLoaderService","ClassroomModel","TestModel","ServerFileModel","$controller",function(h,g,j,c,b){var i=this;i.classrooms=g.records;i.strs={Classrooms:"Classrooms",Tests:"Tests",Colleagues:"Colleagues","Invite a colleague on sukull":"Invite a colleague on sukull","All tests":"All tests","All classrooms":"All classrooms",Profile:"Profile",Settings:"Settings",Logout:"Logout","Uploading file":"Uploading file",Error:"Error","Unable to reach the server":"Unable to reach the server","All the changes made now may not be saved on the server":"All the changes made now may not be saved on the server"};i.tests=j.records;i.user=h.user;i.page=h.page;i.loading=false;i.disconnect=function(){console.log("disconnect");h.disconnect;$.ajax({type:"get",url:"../server/logout",async:false})};var d=function(){i.notificationCtrl=b("NotificationCtrl");i.new_notification=i.notificationCtrl.new_notification;i.showNotifications=function(){i.notificationCtrl.openDialog()};i.notificationCtrl.init()};var f=function(){i.inviteUserCtrl=b("InviteUserCtrl");i.invite=function(){i.inviteUserCtrl.openDialog()};i.inviteUserCtrl.init(g.records)};var e=function(){i.profileCtrl=b("ProfileCtrl");i.profile=function(){i.profileCtrl.openDialog()};i.profileCtrl.init(h.user)};var a=function(){i.serverFileCtrl=c.status;console.log(i.serverFileCtrl)};d();f();e();a()}]);sukuApp.controller("NotificationCtrl",["NotificationService",function(b){var a=this;a.init=function(){a.dialog=angular.element("#notification-modal");a.new_notification=false;a.notifications=b.items;a.olds=b.olds};a.openDialog=function(){a.new_notification=false;a.dialog.modal()}}]);sukuApp.controller("ProfileCtrl",["AuthLoaderService","TranslateService",function(a,c){var b=this;b.init=function(d){b.dialog=angular.element("#profile-modal");b.user=d;b.working=false;b.error=null};b.openDialog=function(){b.dialog.modal()};b.editPwd=function(d,f,e){b.working=true;if(f!=e){b.working=false;b.error=c.tr("The new passwords do not match");return}a.editpwd(d,f,e).then(function(){b.working=false;b.error=null},function(g){b.working=false;b.error=c.tr(g.msg)})};b.editTof=function(d,e){a.edittof(d,e).then(function(f){b.working=false;console.log("editTof");b.error=null},function(f){b.working=false;console.log("editTof2");console.log(f);b.error=f.msg})}}]);sukuApp.controller("SaveItemCtrl",[function(){var a=this;a.setType=function(b){a.dialog=angular.element("#save-"+b+"-modal")};a.setItem=function(b){a.item=angular.copy(b);a.working=false;a.error=null};a.openDialog=function(){a.dialog.modal()};a.save=function(){console.log("save");a.working=true;console.log(a.item);a.item.save().then(function(){a.working=false;a.dialog.modal("hide")},function(b){console.log(b);a.error=b.msg;a.working=false})}}]);sukuApp.controller("ShareEltCtrl",[function(){var a=this;a.setElt=function(b){a.dialog=angular.element("#share-elt-modal");a.working=false;a.error=null;a.elt=b};a.openDialog=function(){a.dialog.modal()};a.share=function(b){a.working=true;a.elt.share(b).then(function(){a.working=false;a.dialog.modal("hide")},function(c){console.log(c);a.error=c.msg;a.working=false})}}]);sukuApp.controller("SKClassroomCtrl",["ClassroomModel","StudentsClassroomModelFactory","TestModel","ModelLoaderService","$controller","$routeParams","$location","$q",function(i,k,h,a,b,m,g,j){var o=this;o.switchViewCtrl=b("SwitchViewCtrl");o.switchViewCtrl.init(2);o.headers=[{name:"name"},{name:"email"},{name:"sexe",index:"sexe_code"}];o.view_icon="fa fa-user";o.classroom=i.find_by_sid(m.id);if(!o.classroom){console.log(m.id+" does not exist");g.path("/");return}var e=k.create(m.id);o.students=e.records;var l=function(){o.saveStudentCtrl=b("SaveItemCtrl");o.saveStudentCtrl.setType("student");o.new_student=function(){o.saveStudentCtrl.setItem(new e({}));o.saveStudentCtrl.openDialog()};o.edit_student=function(p){o.saveStudentCtrl.setItem(p);o.saveStudentCtrl.openDialog()};o.remove_student=function(p){console.log(p)}};var d=function(){o.shareCtrl=b("ShareEltCtrl");o.shareCtrl.setElt(o.classroom);o.share=function(){o.shareCtrl.openDialog()}};var c=function(){o.saveTestCtrl=b("SaveItemCtrl");o.saveTestCtrl.setType("test");o.new_test=function(){o.saveTestCtrl.setItem(new h({classroom:o.classroom}));o.saveTestCtrl.openDialog()};o.edit_test=function(p){o.saveTestCtrl.setItem(p);o.saveTestCtrl.openDialog()};o.remove_test=function(p){console.log(p)}};var f=function(){o.importStudentsCtrl=b("ImportStudentsCtrl");o.importStudentsCtrl.setClassroomCtrl(o);o.import_students=function(){console.log("import students");o.importStudentsCtrl.init()};o.import_students_from_file=function(r){var p=j.defer();var s=r.length;if(s==0){p.resolve()}for(var q=0;q<r.length;++q){e.import_students_from_file(r[q]).then(function(){if(--s==0){p.resolve()}},function(t){if(--s==0){p.reject(t)}})}return p.promise}};var n=function(){o.propCtrl=b("ClassroomPropertiesCtrl");o.propCtrl.setClassroom(o.classroom);o.more=function(){o.propCtrl.setClassroom(o.classroom);o.propCtrl.openDialog()}};l();c();f();d();n()}]);sukuApp.controller("SKClassroomsCtrl",["ClassroomModel","ModelLoaderService","TranslateService","$controller","$location",function(d,c,e,a,f){var b=this;b.strs={"New Classroom":"New Classroom"};b.switchViewCtrl=a("SwitchViewCtrl");b.switchViewCtrl.init(2);b.switchViewCtrl.go(1);b.headers=[{name:"name",model:d},{name:"school",model:d},{name:"responsible",model:d}];b.view_icon="fa fa-university";b.classrooms=d.records;b.ClassroomModel=d;b.saveCtrl=a("SaveItemCtrl");b.saveCtrl.setType("classroom");b.add=function(){b.saveCtrl.setItem(new d({}));b.saveCtrl.openDialog()};b.edit=function(g){b.saveCtrl.setItem(g);b.saveCtrl.openDialog()};b.remove=function(g){g.sdestroy().then(function(){},function(h){console.log(h);alert(e.tr(h.msg))})};b.open=function(g){f.path("/classrooms/"+g.sid)}}]);sukuApp.controller("SKTestCtrl",["TestModel","MarksTestModelFactory","ClassroomModel","StudentsClassroomModelFactory","ModelLoaderService","TranslateService","$routeParams","$controller",function(g,d,h,j,a,f,k,b){var m=this;m.id=k.id;m.MarksModel=d.create(m.id);var i=g.find_by_sid(m.id);if(!i){console.log(k.id+" does not exist");$location.path("/");return}m.test=i;var c=i.classroom;c=h.find_by_sid(c.sid);m.StudentsModel=j.create(c.sid);m.StudentsModel.each(function(n){var o=m.MarksModel.stdids[n.sid];if(!o){o=new m.MarksModel({student_id:n.sid,value:0,name:n.name})}o.psave();console.log(o)});m.headers=[{name:f.tr("name"),index:"name",model:m.StudentsModel},{name:f.tr("sexe"),index:"sexe_code",model:m.StudentsModel},{name:m.test.code,index:"value",model:m.MarksModel},{name:f.tr("appreciation"),formula:"mgp(c1)"},{name:f.tr("result"),formula:"success_fail(c1)"},{name:f.tr("sexe-result"),formula:"sexe_mark(b1, c1)"}];var e=function(){m.shareCtrl=b("ShareEltCtrl");m.shareCtrl.setElt(m.test);m.share=function(){m.shareCtrl.openDialog()}};var l=function(){m.propCtrl=b("TestPropertiesCtrl");m.propCtrl.setTest(m.test);m.more=function(){console.log(m.test);m.propCtrl.setTest(m.test);m.propCtrl.openDialog()}};e();l()}]);sukuApp.controller("SKTestsCtrl",["TestModel","ModelLoaderService","TranslateService","$controller","$location",function(d,c,e,a,f){var b=this;b.switchViewCtrl=a("SwitchViewCtrl");b.switchViewCtrl.init(2);b.headers=[{name:"code"},{name:"classroom",index:"classroom_name"},{name:"subject"},{name:"responsible"},{name:"date"}];b.view_icon="fa fa-edit";b.tests=d.records;b.saveCtrl=a("SaveItemCtrl");b.saveCtrl.setType("test");b.add=function(){b.saveCtrl.openDialog()};b.edit=function(g){b.saveCtrl.setItem(g);b.saveCtrl.openDialog()};b.remove=function(g){g.sdestroy().then(function(){},function(h){alert(e.tr(h.msg))})};b.open=function(g){f.path("/tests/"+g.sid)}}]);sukuApp.controller("SwitchViewCtrl",[function(){var a=this;a.init=function(b){a.current_tab=0;a.max_tab=b};a.next=function(){a.current_tab=(++a.current_tab)%a.max_tab};a.go=function(b){a.current_tab=b%a.max_tab}}]);sukuApp.controller("TestPropertiesCtrl",["ClassroomModel","StudentsClassroomModelFactory","MarksTestModelFactory",function(d,c,a){var b=this;b.setTest=function(w){b.dialog=angular.element("#test-properties-modal");b.working=false;b.error=null;b.loading=true;b.test=w;b.files=w.files;b.olds=w.olds;b.comments=w.comments;w.getOldComments().then(function(){b.loading=false},function(){b.error="error while getting messages";console.log("bad")});var A=a.elts[b.test.sid];if(!A){return}var B=c.elts[b.test.classroom.sid];if(!B){return}var l=B.count();var r=0,z=0;B.each(function(C){if(C.sexe=="1"){++r}if(C.sexe=="2"){++z}});var y=0,p=0,k=0,v=0;var i=0,x=0,m=0;var o=0,q=0,h=0;A.each(function(D){var C=B.find_by_sid(D.student_id);if(C==null){return}D.value=parseFloat(D.value);if(D.value>=10){++y;if(C.sexe=="1"){++k}if(C.sexe=="2"){++i}}else{++p;if(C.sexe=="1"){++x}if(C.sexe=="2"){++o}}if(C.sexe=="1"){q+=D.value}if(C.sexe=="2"){h+=D.value}v+=D.value});if(l>0){v/=l;v=Number(v).toFixed(2)}else{v=0}if(r>0){q/=r;q=Number(q).toFixed(2)}else{q=0}if(z>0){h/=z;h=Number(h).toFixed(2)}else{h=0}var f=0,t=0,u=0,g=0;var n=0,j=0;var e=0,s=0;if(l){u=Number(100*r/l).toFixed(1);g=Number(100*z/l).toFixed(1);f=Number(100*y/l).toFixed(1);t=Number(100*p/l).toFixed(1)}if(r){n=Number(100*k/r).toFixed(1);e=Number(100*x/r).toFixed(1)}if(z){j=Number(100*i/z).toFixed(1);s=Number(100*o/z).toFixed(1)}b.properties={responsible:b.test.responsible,title:b.test.code+", "+b.test.classroom.name,std:l,male:r,male_per:u,female:z,female_per:g,mean:v,success_per:f,fail_per:t,male_success:k,male_fail:x,female_success:i,success:y,female_fail:o,fail:p,male_mean:q,female_mean:h,male_success_per:n,male_fail_per:e,female_success_per:j,female_fail_per:s}};b.openDialog=function(){b.dialog.modal()};b.publish=function(f){b.working=true;var e={msg:f};b.test.publish(e).then(function(){b.working=false;b.error=null},function(g){console.log(g);b.error=g.msg;b.working=false})};b.addFile=function(e){console.log(b.test);b.test.addFile(e).then(function(f){b.working=false;console.log("add file");b.error=null;console.log(e);b.publish("attached a file ("+e.name+")")},function(f){b.working=false;console.log(f);b.error=f.msg})}}]);