(function(){var f,d,p,h,b,g,n,m,j,e,a,o,i=[].slice,q=[].indexOf||function(t){for(var s=0,r=this.length;s<r;s++){if(s in this&&this[s]===t){return s}}return -1},l={}.hasOwnProperty,c=function(u,s){for(var r in s){if(l.call(s,r)){u[r]=s[r]}}function t(){this.constructor=u}t.prototype=s.prototype;u.prototype=new t();u.__super__=s.prototype;return u},k=function(r,s){return function(){return r.apply(s,arguments)}};p={bind:function(v,x){var s,t,u,w,r;s=v.split(" ");if(!(this.hasOwnProperty("_callbacks")&&this._callbacks)){this._callbacks={}}for(w=0,r=s.length;w<r;w++){t=s[w];(u=this._callbacks)[t]||(u[t]=[]);this._callbacks[t].push(x)}return this},one:function(s,t){var r;return this.bind(s,r=function(){this.unbind(s,r);return t.apply(this,arguments)})},trigger:function(){var s,x,t,w,v,r,u;s=1<=arguments.length?i.call(arguments,0):[];t=s.shift();w=this.hasOwnProperty("_callbacks")&&((u=this._callbacks)!=null?u[t]:void 0);if(!w){return}for(v=0,r=w.length;v<r;v++){x=w[v];if(x.apply(this,s)===false){break}}return true},listenTo:function(s,r,t){s.bind(r,t);this.listeningTo||(this.listeningTo=[]);this.listeningTo.push({obj:s,ev:r,callback:t});return this},listenToOnce:function(u,t,v){var s,r;r=this.listeningToOnce||(this.listeningToOnce=[]);u.bind(t,s=function(){var z,x,w,A,y;x=-1;for(z=A=0,y=r.length;A<y;z=++A){w=r[z];if(w.obj===u){if(w.ev===t&&w.callback===v){x=z}}}u.unbind(t,s);if(x!==-1){r.splice(x,1)}return v.apply(this,arguments)});r.push({obj:u,ev:t,callback:v,handler:s});return this},stopListening:function(C,s,x){var E,F,A,D,y,z,v,t,r,G,I,H,B,w,u;if(arguments.length===0){B=[this.listeningTo,this.listeningToOnce];for(v=0,G=B.length;v<G;v++){y=B[v];if(!y){continue}for(t=0,I=y.length;t<I;t++){z=y[t];z.obj.unbind(z.ev,z.handler||z.callback)}}this.listeningTo=void 0;return this.listeningToOnce=void 0}else{if(C){w=[this.listeningTo,this.listeningToOnce];u=[];for(r=0,H=w.length;r<H;r++){y=w[r];if(!y){continue}s=s?s.split(" "):[void 0];u.push((function(){var K,L,J;J=[];for(K=0,L=s.length;K<L;K++){F=s[K];J.push((function(){var N,O,M;M=[];for(D=N=O=y.length-1;O<=0?N<=0:N>=0;D=O<=0?++N:--N){z=y[D];if(x&&(z.handler||z.callback)!==x){continue}if((!F)||(F===z.ev)){z.obj.unbind(z.ev,z.handler||z.callback);if(D!==-1){M.push(y.splice(D,1))}else{M.push(void 0)}}else{if(F){A=z.ev.split(" ");if(q.call(A,F)>=0){A=(function(){var R,Q,P;P=[];for(Q=0,R=A.length;Q<R;Q++){E=A[Q];if(E!==F){P.push(E)}}return P})();z.ev=f.trim(A.join(" "));M.push(z.obj.unbind(F,z.handler||z.callback))}else{M.push(void 0)}}else{M.push(void 0)}}}return M})())}return J})())}return u}}},unbind:function(z,B){var t,C,x,y,r,v,u,A,s,w;if(arguments.length===0){this._callbacks={};return this}if(!z){return this}C=z.split(" ");for(v=0,A=C.length;v<A;v++){r=C[v];y=(w=this._callbacks)!=null?w[r]:void 0;if(!y){continue}if(!B){delete this._callbacks[r];continue}for(x=u=0,s=y.length;u<s;x=++u){t=y[x];if(!(t===B)){continue}y=y.slice();y.splice(x,1);this._callbacks[r]=y;break}}return this}};p.on=p.bind;p.off=p.unbind;h={trace:true,logPrefix:"(App)",log:function(){var r;r=1<=arguments.length?i.call(arguments,0):[];if(!this.trace){return}if(this.logPrefix){r.unshift(this.logPrefix)}if(typeof console!=="undefined"&&console!==null){if(typeof console.log==="function"){console.log.apply(console,r)}}return this}};o=["included","extended"];g=(function(){r.include=function(v){var s,u,t;if(!v){throw new Error("include(obj) requires obj")}for(s in v){u=v[s];if(q.call(o,s)<0){this.prototype[s]=u}}if((t=v.included)!=null){t.apply(this)}return this};r.extend=function(v){var s,u,t;if(!v){throw new Error("extend(obj) requires obj")}for(s in v){u=v[s];if(q.call(o,s)<0){this[s]=u}}if((t=v.extended)!=null){t.apply(this)}return this};r.proxy=function(s){return(function(t){return function(){return s.apply(t,arguments)}})(this)};r.prototype.proxy=function(s){return(function(t){return function(){return s.apply(t,arguments)}})(this)};function r(){if(typeof this.init==="function"){this.init.apply(this,arguments)}}return r})();b=(function(r){c(s,r);s.extend(p);s.records=[];s.irecords={};s.attributes=[];s.configure=function(){var t,u;u=arguments[0],t=2<=arguments.length?i.call(arguments,1):[];this.className=u;this.deleteAll();if(t.length){this.attributes=t}this.attributes&&(this.attributes=a(this.attributes));this.attributes||(this.attributes=[]);this.unbind();return this};s.toString=function(){return""+this.className+"("+(this.attributes.join(", "))+")"};s.find=function(v,t){var u;if(t==null){t=this.notFound}return((u=this.irecords[v])!=null?u.clone():void 0)||(typeof t==="function"?t(v):void 0)};s.findAll=function(v,w){var y,x,u,t;t=[];for(x=0,u=v.length;x<u;x++){y=v[x];if(this.find(y,w)){t.push(this.find(y))}}return t};s.notFound=function(t){return null};s.exists=function(t){return Boolean(this.irecords[t])};s.addRecord=function(u,w){var x,y,t,v;if(w==null){w={}}if(u.id&&this.irecords[u.id]){this.irecords[u.id].remove(w);if(!w.clear){u=this.irecords[u.id].load(u)}}u.id||(u.id=u.cid);if((x=this.irecords)[t=u.id]==null){x[t]=u}if((y=this.irecords)[v=u.cid]==null){y[v]=u}return this.records.push(u)};s.refresh=function(x,y){var v,w,t,z,u;if(y==null){y={}}if(y.clear){this.deleteAll()}w=this.fromJSON(x);if(!j(w)){w=[w]}for(z=0,u=w.length;z<u;z++){v=w[z];this.addRecord(v,y)}this.sort();t=this.cloneArray(w);this.trigger("refresh",t,y);return t};s.select=function(y){var v,x,u,w,t;w=this.records;t=[];for(x=0,u=w.length;x<u;x++){v=w[x];if(y(v)){t.push(v.clone())}}return t};s.findByAttribute=function(v,y){var u,x,t,w;w=this.records;for(x=0,t=w.length;x<t;x++){u=w[x];if(u[v]===y){return u.clone()}}return null};s.findAllByAttribute=function(t,u){return this.select(function(v){return v[t]===u})};s.each=function(y){var v,x,u,w,t;w=this.records;t=[];for(x=0,u=w.length;x<u;x++){v=w[x];t.push(y(v.clone()))}return t};s.all=function(){return this.cloneArray(this.records)};s.slice=function(u,t){if(u==null){u=0}return this.cloneArray(this.records.slice(u,t))};s.first=function(t){var u;if(t==null){t=1}if(t>1){return this.cloneArray(this.records.slice(0,t))}else{return(u=this.records[0])!=null?u.clone():void 0}};s.last=function(t){var u;if(typeof t==="number"){return this.cloneArray(this.records.slice(-t))}else{return(u=this.records[this.records.length-1])!=null?u.clone():void 0}};s.count=function(){return this.records.length};s.deleteAll=function(){this.records=[];return this.irecords={}};s.destroyAll=function(w){var v,y,u,x,t;x=this.records;t=[];for(y=0,u=x.length;y<u;y++){v=x[y];t.push(v.destroy(w))}return t};s.update=function(v,u,t){return this.find(v).updateAttributes(u,t)};s.create=function(v,u){var t;t=new this(v);return t.save(u)};s.destroy=function(u,t){return this.find(u).destroy(t)};s.change=function(t){if(typeof t==="function"){return this.bind("change",t)}else{return this.trigger.apply(this,["change"].concat(i.call(arguments)))}};s.fetch=function(t){if(typeof t==="function"){return this.bind("fetch",t)}else{return this.trigger.apply(this,["fetch"].concat(i.call(arguments)))}};s.toJSON=function(){return this.records};s.fromJSON=function(x){var w,v,u,t;if(!x){return}if(typeof x==="string"){x=JSON.parse(x)}if(j(x)){t=[];for(v=0,u=x.length;v<u;v++){w=x[v];if(w instanceof this){t.push(w)}else{t.push(new this(w))}}return t}else{if(x instanceof this){return x}return new this(x)}};s.fromForm=function(){var t;return(t=new this).fromForm.apply(t,arguments)};s.sort=function(){if(this.comparator){this.records.sort(this.comparator)}return this};s.cloneArray=function(x){var w,v,u,t;t=[];for(v=0,u=x.length;v<u;v++){w=x[v];t.push(w.clone())}return t};s.idCounter=0;s.uid=function(u){var t;if(u==null){u=""}t=u+this.idCounter++;if(this.exists(t)){t=this.uid(u)}return t};function s(t){s.__super__.constructor.apply(this,arguments);if((this.constructor.uuid!=null)&&typeof this.constructor.uuid==="function"){this.cid=this.constructor.uuid();if(!this.id){this.id=this.cid}}else{this.cid=(t!=null?t.cid:void 0)||this.constructor.uid("c-")}if(t){this.load(t)}}s.prototype.isNew=function(){return !this.exists()};s.prototype.isValid=function(){return !this.validate()};s.prototype.validate=function(){};s.prototype.load=function(v){var t,u;if(v.id){this.id=v.id}for(t in v){u=v[t];if(typeof this[t]==="function"){if(typeof u==="function"){continue}this[t](u)}else{this[t]=u}}return this};s.prototype.attributes=function(){var v,t,x,u,w;t={};w=this.constructor.attributes;for(x=0,u=w.length;x<u;x++){v=w[x];if(v in this){if(typeof this[v]==="function"){t[v]=this[v]()}else{t[v]=this[v]}}}if(this.id){t.id=this.id}return t};s.prototype.eql=function(t){return t&&t.constructor===this.constructor&&((t.cid===this.cid)||(t.id&&t.id===this.id))};s.prototype.save=function(v){var u,t;if(v==null){v={}}if(v.validate!==false){u=this.validate();if(u){this.trigger("error",u);return false}}this.trigger("beforeSave",v);t=this.isNew()?this.create(v):this.update(v);this.stripCloneAttrs();this.trigger("save",v);return t};s.prototype.stripCloneAttrs=function(){var t,u;if(this.hasOwnProperty("cid")){return}for(t in this){if(!l.call(this,t)){continue}u=this[t];if(q.call(this.constructor.attributes,t)>=0){delete this[t]}}return this};s.prototype.updateAttribute=function(u,v,t){var w;w={};w[u]=v;return this.updateAttributes(w,t)};s.prototype.updateAttributes=function(u,t){this.load(u);return this.save(t)};s.prototype.changeID=function(u){var t;if(u===this.id){return}t=this.constructor.irecords;t[u]=t[this.id];if(this.cid!==this.id){delete t[this.id]}this.id=u;return this.save()};s.prototype.remove=function(w){var x,u,v,y,t;if(w==null){w={}}v=this.constructor.records.slice(0);for(x=y=0,t=v.length;y<t;x=++y){u=v[x];if(!(this.eql(u))){continue}v.splice(x,1);break}this.constructor.records=v;if(w.clear){delete this.constructor.irecords[this.id];return delete this.constructor.irecords[this.cid]}};s.prototype.destroy=function(t){if(t==null){t={}}if(t.clear==null){t.clear=true}this.trigger("beforeDestroy",t);this.remove(t);this.destroyed=true;this.trigger("destroy",t);this.trigger("change","destroy",t);if(this.listeningTo){this.stopListening()}this.unbind();return this};s.prototype.dup=function(t){var u;if(t==null){t=true}u=this.attributes();if(t){delete u.id}else{u.cid=this.cid}return new this.constructor(u)};s.prototype.clone=function(){return m(this)};s.prototype.reload=function(){var t;if(this.isNew()){return this}t=this.constructor.find(this.id);this.load(t.attributes());return t};s.prototype.refresh=function(u){var t;t=this.constructor.irecords[this.id];t.load(u);this.trigger("refresh");return this};s.prototype.toJSON=function(){return this.attributes()};s.prototype.toString=function(){return"<"+this.constructor.className+" ("+(JSON.stringify(this))+")>"};s.prototype.fromForm=function(w){var D,G,u,H,B,A,y,E,v,t,F,C,z,x;H={};C=f(w).find("[type=checkbox]:not([value])");for(B=0,E=C.length;B<E;B++){D=C[B];H[D.name]=f(D).prop("checked")}z=f(w).find('[type=checkbox][name$="[]"]');for(A=0,v=z.length;A<v;A++){D=z[A];u=D.name.replace(/\[\]$/,"");H[u]||(H[u]=[]);if(f(D).prop("checked")){H[u].push(D.value)}}x=f(w).serializeArray();for(y=0,t=x.length;y<t;y++){G=x[y];H[F=G.name]||(H[F]=G.value)}return this.load(H)};s.prototype.exists=function(){return this.constructor.exists(this.id)};s.prototype.update=function(u){var v,t;this.trigger("beforeUpdate",u);t=this.constructor.irecords;t[this.id].load(this.attributes());this.constructor.sort();v=t[this.id].clone();v.trigger("update",u);v.trigger("change","update",u);return v};s.prototype.create=function(u){var v,t;this.trigger("beforeCreate",u);this.id||(this.id=this.cid);t=this.dup(false);this.constructor.addRecord(t);this.constructor.sort();v=t.clone();v.trigger("create",u);v.trigger("change","create",u);return v};s.prototype.bind=function(w,A){var v,u,z,y,t,x;this.constructor.bind(w,v=(function(B){return function(C){if(C&&B.eql(C)){return A.apply(B,arguments)}}})(this));x=w.split(" ");z=(function(B){return function(C){var D;return B.constructor.bind("unbind",D=function(F,G,E){if(F&&B.eql(F)){if(G&&G!==C){return}if(E&&E!==A){return}B.constructor.unbind(C,v);return B.constructor.unbind("unbind",D)}})}})(this);for(y=0,t=x.length;y<t;y++){u=x[y];z(u)}return this};s.prototype.one=function(t,v){var u;return this.bind(t,u=(function(w){return function(){w.unbind(t,u);return v.apply(w,arguments)}})(this))};s.prototype.trigger=function(){var t,u;t=1<=arguments.length?i.call(arguments,0):[];t.splice(1,0,this);return(u=this.constructor).trigger.apply(u,t)};s.prototype.listenTo=function(){return p.listenTo.apply(this,arguments)};s.prototype.listenToOnce=function(){return p.listenToOnce.apply(this,arguments)};s.prototype.stopListening=function(){return p.stopListening.apply(this,arguments)};s.prototype.unbind=function(v,z){var w,y,u,x,t;if(arguments.length===0){return this.trigger("unbind")}else{if(v){x=v.split(" ");t=[];for(y=0,u=x.length;y<u;y++){w=x[y];t.push(this.trigger("unbind",w,z))}return t}}};return s})(g);b.prototype.on=b.prototype.bind;b.prototype.off=b.prototype.unbind;d=(function(r){c(s,r);s.include(p);s.include(h);s.prototype.eventSplitter=/^(\S+)\s*(.*)$/;s.prototype.tag="div";function s(t){this.release=k(this.release,this);var v,u,y,x,w;this.options=t;w=this.options;for(u in w){x=w[u];this[u]=x}if(!this.el){this.el=document.createElement(this.tag)}this.el=f(this.el);this.$el=this.el;if(this.className){this.el.addClass(this.className)}if(this.attributes){this.el.attr(this.attributes)}if(!this.events){this.events=this.constructor.events}if(!this.elements){this.elements=this.constructor.elements}v=this;while(y=v.constructor.__super__){if(y.events){this.events=f.extend({},y.events,this.events)}if(y.elements){this.elements=f.extend({},y.elements,this.elements)}v=y}if(this.events){this.delegateEvents(this.events)}if(this.elements){this.refreshElements()}s.__super__.constructor.apply(this,arguments)}s.prototype.release=function(){this.trigger("release",this);this.el.remove();this.unbind();return this.stopListening()};s.prototype.$=function(t){return f(t,this.el)};s.prototype.delegateEvents=function(y){var v,x,w,z,t,u;u=[];for(x in y){z=y[x];if(typeof z==="function"){z=(function(A){return function(B){return function(){B.apply(A,arguments);return true}}})(this)(z)}else{if(!this[z]){throw new Error(""+z+" doesn't exist")}z=(function(A){return function(B){return function(){A[B].apply(A,arguments);return true}}})(this)(z)}w=x.match(this.eventSplitter);v=w[1];t=w[2];if(t===""){u.push(this.el.bind(v,z))}else{u.push(this.el.on(v,t,z))}}return u};s.prototype.refreshElements=function(){var u,w,v,t;v=this.elements;t=[];for(u in v){w=v[u];t.push(this[w]=this.$(u))}return t};s.prototype.delay=function(t,u){return setTimeout(this.proxy(t),u||0)};s.prototype.html=function(t){this.el.html(t.el||t);this.refreshElements();return this.el};s.prototype.append=function(){var v,u,t;u=1<=arguments.length?i.call(arguments,0):[];u=(function(){var y,x,w;w=[];for(y=0,x=u.length;y<x;y++){v=u[y];w.push(v.el||v)}return w})();(t=this.el).append.apply(t,u);this.refreshElements();return this.el};s.prototype.appendTo=function(t){this.el.appendTo(t.el||t);this.refreshElements();return this.el};s.prototype.prepend=function(){var v,u,t;u=1<=arguments.length?i.call(arguments,0):[];u=(function(){var y,x,w;w=[];for(y=0,x=u.length;y<x;y++){v=u[y];w.push(v.el||v)}return w})();(t=this.el).prepend.apply(t,u);this.refreshElements();return this.el};s.prototype.replace=function(u){var v,w,t;u=u.el||u;if(typeof u==="string"){u=f.trim(u)}t=[this.el,f(((w=f.parseHTML(u))!=null?w[0]:void 0)||u)],v=t[0],this.el=t[1];v.replaceWith(this.el);this.delegateEvents(this.events);this.refreshElements();return this.el};return s})(g);f=(typeof window!=="undefined"&&window!==null?window.jQuery:void 0)||(typeof window!=="undefined"&&window!==null?window.Zepto:void 0)||function(r){return r};m=Object.create||function(s){var r;r=function(){};r.prototype=s;return new r()};j=function(r){return Object.prototype.toString.call(r)==="[object Array]"};e=function(s){var r;if(!s){return true}for(r in s){return false}return true};a=function(r){return Array.prototype.slice.call(r,0)};n=this.Spine={};if(typeof module!=="undefined"&&module!==null){module.exports=n}n.version="1.3.2";n.isArray=j;n.isBlank=e;n.$=f;n.Events=p;n.Log=h;n.Module=g;n.Controller=d;n.Model=b;g.extend.call(n,p);g.create=g.sub=d.create=d.sub=b.sub=function(r,s){var t;t=(function(u){c(v,u);function v(){return v.__super__.constructor.apply(this,arguments)}return v})(this);if(r){t.include(r)}if(s){t.extend(s)}if(typeof t.unbind==="function"){t.unbind()}return t};b.setup=function(t,s){var r;if(s==null){s=[]}r=(function(v){c(u,v);function u(){return u.__super__.constructor.apply(this,arguments)}return u})(this);r.configure.apply(r,[t].concat(i.call(s)));return r};n.Class=g}).call(this);